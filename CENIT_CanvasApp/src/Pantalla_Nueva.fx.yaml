Pantalla_Nueva As screen:
    Fill: =RGBA(249, 250, 251, 1)
    OnVisible: =UpdateContext({locFormReady: true})

    # ── HEADER ──────────────────────────────────────────────────
    Rect_Header_Nva As rectangle:
        X: =0
        Y: =0
        Width: =Parent.Width
        Height: =72
        Fill: =RGBA(0, 34, 102, 1)
        BorderThickness: =0

    Btn_Nva_Volver As button:
        X: =0
        Y: =0
        Width: =56
        Height: =72
        Text: ="←"
        Size: =22
        Fill: =RGBA(0, 0, 0, 0)
        Color: =RGBA(255, 255, 255, 1)
        HoverFill: =RGBA(255, 255, 255, 0.1)
        BorderThickness: =0
        OnSelect: =Navigate(Pantalla_Planeacion, ScreenTransition.Fade)

    Lbl_Nva_Header As label:
        X: =56
        Y: =0
        Width: =Parent.Width - 56
        Height: =72
        Text: ="Nueva Actividad Ambiental"
        Color: =RGBA(255, 255, 255, 1)
        Size: =16
        FontWeight: =FontWeight.Bold
        VerticalAlign: =VerticalAlign.Middle

    # ── FORMULARIO ───────────────────────────────────────────────
    Rect_Form_Nva_BG As rectangle:
        X: =10
        Y: =82
        Width: =Parent.Width - 20
        Height: =Parent.Height - 172
        Fill: =RGBA(255, 255, 255, 1)
        BorderThickness: =0
        RadiusTopLeft: =12
        RadiusTopRight: =12
        RadiusBottomLeft: =12
        RadiusBottomRight: =12

    # Tarea (Title) *obligatorio
    Lbl_Nva_Tarea_Cam As label:
        X: =26
        Y: =92
        Width: =240
        Height: =20
        Text: ="Tarea / Actividad *"
        Size: =11
        FontWeight: =FontWeight.Semibold
        Color: =RGBA(75, 85, 99, 1)

    Txt_Nva_Tarea As text:
        X: =26
        Y: =114
        Width: =Parent.Width - 52
        Height: =42
        Default: =""
        HintText: ="Ej: Monitoreo de calidad del aire PM2.5"
        BorderColor: =RGBA(229, 231, 235, 1)
        BorderThickness: =1
        Fill: =RGBA(249, 250, 251, 1)
        Color: =RGBA(31, 41, 55, 1)
        Size: =13
        RadiusTopLeft: =8
        RadiusTopRight: =8
        RadiusBottomLeft: =8
        RadiusBottomRight: =8

    # Tipo + Prioridad
    Lbl_Nva_Tipo_Cam As label:
        X: =26
        Y: =166
        Width: =160
        Height: =20
        Text: ="Tipo de Actividad *"
        Size: =11
        FontWeight: =FontWeight.Semibold
        Color: =RGBA(75, 85, 99, 1)

    Drp_Nva_Tipo As dropdown:
        X: =26
        Y: =188
        Width: =(Parent.Width - 62) / 2
        Height: =42
        Items: =["Monitoreo","Auditoría","Mantenimiento","Inspección","Capacitación","Otro"]
        Default: ="Monitoreo"
        BorderColor: =RGBA(229, 231, 235, 1)
        BorderThickness: =1
        Fill: =RGBA(249, 250, 251, 1)
        Color: =RGBA(31, 41, 55, 1)
        Size: =12
        RadiusTopLeft: =8
        RadiusTopRight: =8
        RadiusBottomLeft: =8
        RadiusBottomRight: =8

    Lbl_Nva_Prio_Cam As label:
        X: =36 + (Parent.Width - 62) / 2
        Y: =166
        Width: =160
        Height: =20
        Text: ="Prioridad *"
        Size: =11
        FontWeight: =FontWeight.Semibold
        Color: =RGBA(75, 85, 99, 1)

    Drp_Nva_Prioridad As dropdown:
        X: =36 + (Parent.Width - 62) / 2
        Y: =188
        Width: =(Parent.Width - 62) / 2
        Height: =42
        Items: =["Media","Alta","Baja"]
        Default: ="Media"
        BorderColor: =RGBA(229, 231, 235, 1)
        BorderThickness: =1
        Fill: =RGBA(249, 250, 251, 1)
        Color: =RGBA(31, 41, 55, 1)
        Size: =12
        RadiusTopLeft: =8
        RadiusTopRight: =8
        RadiusBottomLeft: =8
        RadiusBottomRight: =8

    # Responsable *obligatorio
    Lbl_Nva_Resp_Cam As label:
        X: =26
        Y: =240
        Width: =200
        Height: =20
        Text: ="Responsable *"
        Size: =11
        FontWeight: =FontWeight.Semibold
        Color: =RGBA(75, 85, 99, 1)

    Txt_Nva_Responsable As text:
        X: =26
        Y: =262
        Width: =Parent.Width - 52
        Height: =42
        Default: =""
        HintText: ="Nombre del responsable de la actividad"
        BorderColor: =RGBA(229, 231, 235, 1)
        BorderThickness: =1
        Fill: =RGBA(249, 250, 251, 1)
        Color: =RGBA(31, 41, 55, 1)
        Size: =13
        RadiusTopLeft: =8
        RadiusTopRight: =8
        RadiusBottomLeft: =8
        RadiusBottomRight: =8

    # Fechas *obligatorias
    Lbl_Nva_FIni_Cam As label:
        X: =26
        Y: =314
        Width: =160
        Height: =20
        Text: ="Fecha Inicio *"
        Size: =11
        FontWeight: =FontWeight.Semibold
        Color: =RGBA(75, 85, 99, 1)

    Dtp_Nva_FechaInicio As datepicker:
        X: =26
        Y: =336
        Width: =(Parent.Width - 62) / 2
        Height: =42
        SelectedDate: =Today()
        Format: =DateTimeFormat.ShortDate
        BorderColor: =RGBA(229, 231, 235, 1)
        BorderThickness: =1
        Fill: =RGBA(249, 250, 251, 1)
        Color: =RGBA(31, 41, 55, 1)
        Size: =12
        RadiusTopLeft: =8
        RadiusTopRight: =8
        RadiusBottomLeft: =8
        RadiusBottomRight: =8

    Lbl_Nva_FFin_Cam As label:
        X: =36 + (Parent.Width - 62) / 2
        Y: =314
        Width: =160
        Height: =20
        Text: ="Fecha Fin *"
        Size: =11
        FontWeight: =FontWeight.Semibold
        Color: =RGBA(75, 85, 99, 1)

    Dtp_Nva_FechaFin As datepicker:
        X: =36 + (Parent.Width - 62) / 2
        Y: =336
        Width: =(Parent.Width - 62) / 2
        Height: =42
        SelectedDate: =Today() + 30
        Format: =DateTimeFormat.ShortDate
        BorderColor: =RGBA(229, 231, 235, 1)
        BorderThickness: =1
        Fill: =RGBA(249, 250, 251, 1)
        Color: =RGBA(31, 41, 55, 1)
        Size: =12
        RadiusTopLeft: =8
        RadiusTopRight: =8
        RadiusBottomLeft: =8
        RadiusBottomRight: =8

    # Zona *obligatoria
    Lbl_Nva_Zona_Cam As label:
        X: =26
        Y: =388
        Width: =200
        Height: =20
        Text: ="Ubicación / Zona *"
        Size: =11
        FontWeight: =FontWeight.Semibold
        Color: =RGBA(75, 85, 99, 1)

    Drp_Nva_Zona As dropdown:
        X: =26
        Y: =410
        Width: =Parent.Width - 52
        Height: =42
        Items: =["Zona Norte - Planta Principal","Zona Sur - Orilla del Río","Bodega Central","Zona Industrial","Área Administrativa","Campo - Oleoducto Norte","Campo - Oleoducto Sur","Estación de Bombeo 1","Estación de Bombeo 2","Otra"]
        Default: ="Zona Norte - Planta Principal"
        BorderColor: =RGBA(229, 231, 235, 1)
        BorderThickness: =1
        Fill: =RGBA(249, 250, 251, 1)
        Color: =RGBA(31, 41, 55, 1)
        Size: =12
        RadiusTopLeft: =8
        RadiusTopRight: =8
        RadiusBottomLeft: =8
        RadiusBottomRight: =8

    # Norma (opcional)
    Lbl_Nva_Norma_Cam As label:
        X: =26
        Y: =462
        Width: =200
        Height: =20
        Text: ="Norma / Reglamentación"
        Size: =11
        FontWeight: =FontWeight.Semibold
        Color: =RGBA(75, 85, 99, 1)

    Txt_Nva_Norma As text:
        X: =26
        Y: =484
        Width: =Parent.Width - 52
        Height: =42
        Default: =""
        HintText: ="Ej: Res. 2254/2017 MADS (opcional)"
        BorderColor: =RGBA(229, 231, 235, 1)
        BorderThickness: =1
        Fill: =RGBA(249, 250, 251, 1)
        Color: =RGBA(31, 41, 55, 1)
        Size: =12
        RadiusTopLeft: =8
        RadiusTopRight: =8
        RadiusBottomLeft: =8
        RadiusBottomRight: =8

    # Descripción (opcional)
    Lbl_Nva_Desc_Cam As label:
        X: =26
        Y: =536
        Width: =200
        Height: =20
        Text: ="Descripción"
        Size: =11
        FontWeight: =FontWeight.Semibold
        Color: =RGBA(75, 85, 99, 1)

    Txt_Nva_Descripcion As text:
        X: =26
        Y: =558
        Width: =Parent.Width - 52
        Height: =70
        Default: =""
        HintText: ="Descripción breve de la actividad (opcional)..."
        Mode: =TextMode.MultiLine
        BorderColor: =RGBA(229, 231, 235, 1)
        BorderThickness: =1
        Fill: =RGBA(249, 250, 251, 1)
        Color: =RGBA(31, 41, 55, 1)
        Size: =12
        RadiusTopLeft: =8
        RadiusTopRight: =8
        RadiusBottomLeft: =8
        RadiusBottomRight: =8

    Lbl_Nva_Reqs As label:
        X: =26
        Y: =638
        Width: =Parent.Width - 52
        Height: =32
        Text: ="* Campos obligatorios. La actividad se guardará con Estado = Planeada y 0% de avance."
        Size: =11
        Color: =RGBA(75, 85, 99, 1)
        Overflow: =Overflow.Auto

    # ── BOTÓN CREAR ───────────────────────────────────────────────
    Btn_Nva_Crear As button:
        X: =10
        Y: =Parent.Height - 76
        Width: =Parent.Width - 20
        Height: =54
        Text: ="Crear actividad ambiental"
        Size: =15
        FontWeight: =FontWeight.Bold
        Fill: =RGBA(0, 51, 160, 1)
        Color: =RGBA(255, 255, 255, 1)
        HoverFill: =RGBA(0, 86, 210, 1)
        PressedFill: =RGBA(0, 34, 102, 1)
        BorderThickness: =0
        RadiusTopLeft: =12
        RadiusTopRight: =12
        RadiusBottomLeft: =12
        RadiusBottomRight: =12
        OnSelect: |-
            =If(
                IsBlank(Txt_Nva_Tarea.Text) || IsBlank(Txt_Nva_Responsable.Text),
                Notify("Los campos Tarea y Responsable son obligatorios", NotificationType.Error),
                If(
                    Dtp_Nva_FechaFin.SelectedDate < Dtp_Nva_FechaInicio.SelectedDate,
                    Notify("La fecha de fin no puede ser anterior a la de inicio", NotificationType.Error),
                    Patch(
                        ActividadesAmbientales,
                        Defaults(ActividadesAmbientales),
                        {
                            Title:                 Txt_Nva_Tarea.Text,
                            TipoActividad:         Drp_Nva_Tipo.Selected.Value,
                            Prioridad:             Drp_Nva_Prioridad.Selected.Value,
                            Estado:                "Planeada",
                            PorcentajeAvance:      0,
                            Responsable:           Txt_Nva_Responsable.Text,
                            FechaInicio:           Dtp_Nva_FechaInicio.SelectedDate,
                            FechaFin:              Dtp_Nva_FechaFin.SelectedDate,
                            UbicacionZona:         Drp_Nva_Zona.Selected.Value,
                            CumplimientoNormativo: Txt_Nva_Norma.Text,
                            Descripcion:           Txt_Nva_Descripcion.Text,
                            EstadoAprobacion:      "Pendiente"
                        }
                    );
                    Notify("Actividad creada correctamente", NotificationType.Success);
                    Navigate(Pantalla_Planeacion, ScreenTransition.Fade)
                )
            )
